## 通关前的一些小思考（对这十道题通用解题逻辑的思考，和通过这十题对攻防的理解）

说真的，这是我第一次接触靶场，当配置好环境后我面对第一题陷入了沉思，我不知道这个游戏该怎么玩，更不知道该如何下手。

但当我看了一些视频和阶段五附赠的一些播客后，我注意到了每关的php代码中都有这段个js函数，这是一个弹窗（alert），函数写着“你完成的不错”，后面有跳转到下一题的链接。所以 * *通关的关键就在于这个弹窗，在于我们如何触发这个弹窗。*



![屏幕截图 2025-05-13 214406](靶场任务图片/屏幕截图 2025-05-12 214406.png)



所以我们要将alert指令插入这个网页，但我们不能直接右键搜索打开这个页面的源代码对此进行修改，*** 我们只能通过找到该页面的一些漏洞：如对一些特定的词，或者 “”、''等符号过滤不彻底等，并通过一些特殊的通道如对话框、链接等特殊的点，将我们的输入间接转化为源代码的一部分：如将alert插入源代码，触发特定函数，从而通关。***



有了这一逻辑，我们可以通过一道题来论证我们的观点：如第二题

<img src="https://github.com/thr-del/Task/blob/master/%E9%9D%B6%E5%9C%BA%E4%BB%BB%E5%8A%A1%E5%9B%BE%E7%89%87/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-05-13%20221542.png" alt="屏幕截图 2025-05-13 221145" style="zoom: 50%;" />

这道题首先一个显著的特点是有一个对话框：这满足我们逻辑中有一些特殊的通道可以将我们的输入嵌入到源码中这个要求。比如我们输入111111，则在源码中也会出现11111。*** 但这只是出现，我们要将我们的输入转化成在源码中真正能够产生功能的语句。***



<img src="https://github.com/thr-del/Task/blob/master/%E9%9D%B6%E5%9C%BA%E4%BB%BB%E5%8A%A1%E5%9B%BE%E7%89%87/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-05-13%172713.png" alt="屏幕截图 2025-05-13 172713" style="zoom: 50%;" />

接着我们可以试着找一些漏洞如过滤不彻底等问题来实现这一点，我们先尝试在输入框中输入一个双引号，因为看到value属性是用双引号包裹的，我们在对话框中输入双引号可能导致其属性提前闭合。所以我们可以看到value这个属性没有把我们输入的双引号当成一个字符串，没有把他包裹起来。所以我们可以利用双引号对原码进行一个干扰。



<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-14 172713.png" alt="屏幕截图 2025-05-14 172713" style="zoom:%;50" />





![屏幕截图 2025-05-14 172719](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-14 172719.png)

于是我们可以输入以下语句,我们可以看到由于双引号导致的提前闭合，onclick直接从value中跳了出来直接单独成了input中的一个属性，而onclick=alert(1)则是完成了我们的目的，将alert间接插入了源码中，然后通过点击就可以触发弹窗。然后通关。

```
" onclick=alert(1) "
```

![屏幕截图 2025-05-14 174406](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-14 174406.png)



对攻防的一些理解

1.做完这一题，我们发现我们所做的一切是为插入alert，然后触发弹窗通关。说白了就是执行这个函数，而alert说到底也只不过是一种形式的载体。所以说如果我们将这个函数改的更为复杂，让他不是执行弹窗，而是执行一些更为复杂的功能，如获得一些信息等，并通过一些载体，如本题中的alert，让源程序执行我们的函数，从而达到我们的目的。从而实现一些网络攻击。

![屏幕截图 2025-05-14 175202](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-14 175202.png)

2.我将这十题的攻防游戏用了一个类似但更方便理解的方式表示-——“炮弹和车”。

前提：我们需要将炮弹运进城内，而避免被守城门的士兵发现。那么，

*** 炮弹——函数（我们所期望的功能）*** 

*** 装炮弹的车——载体（alert）***

*** 如何将炮弹藏在车里运输进城——找漏洞的方法***

*** 一个比较容易的通道——类似于弹窗这类比较容易攻击的点。***

而防守者则需要通过一些方法：如通过一些函数（替换函数等）来避免我们这么做。



![屏幕截图 2025-05-14 182532](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-14 182532.png)

***

## 第一题

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-14 191139.png" alt="屏幕截图 2025-05-14 191139" style="zoom:50%;" />



### 解题过程

在第一题中我们发现这里并没有输入框之类突破点将我们的输入插入源代码，那我们可以在地址栏中通过对URL参数进行修改或添加来达到插入alert的目的。

![屏幕截图 2025-05-14 202806](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-14 202806.png)

这是一个典型的反射性XSS型反射，当我们输入的数据（无论是通过输入框提交，还是在URL参数中传递）没有经过有效过滤和转义就直接输出到页面时，就会引发反射型XSS。比如说我们直接输入一个在URL的后面输入以下代码来验证一下
```
?name=<a href="    ">网站名</a>
```

注意：

？：是URL中用于分隔查询参数与路径的符号。它表示后面的内容是传递给服务器的查询参数。

name：是自定义的一个参数名，用于将后面的值传递给服务器端的脚本（level1.php）。

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-14 204221.png" alt="屏幕截图 2025-05-14 204221" style="zoom:50%;" />

发现他对我们输入的数据确实没有过滤。那我们就可以直接输入以下代码，是<script>标签和其中的js代码执行，触发alert弹窗，从而通关。

~~~
?name=<script>alert(1)</script>
~~~

***

## 第二题

看上面的的思考部分



***

## 第三题

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-14 204929.png" alt="屏幕截图 2025-05-14 204929" style="zoom:50%;" />

我们还是按照第二题的思路，在输入框中输入一个双引号，但此时是我们发现了出现了一个问题：他将输入的双引号当成一个字符串给包裹起来了。而且双击这个“”，会发现他变成了&quot，这其实是通过html实体转义实现的（ps：html实体转义是一种将特殊字符转换为html实体的技术，用于在文档中安全地显示这些字符，避免它们被浏览器误解为html标签或特殊字符。）

![屏幕截图 2025-05-14 205453](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-14 205453.png)

![屏幕截图 2025-05-14 210251](C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-14 210251.png)

![屏幕截图 2025-05-14 210251](C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-14 210251.png)

而且通过对第二关，第三关php代码的对比分析，发现他这个html实体转移是通过htmlspecialchars函数来实现的，但这个函数不转义单引号，比方说我们输入单引号，发现其并未被包裹。

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-14 210251.png" alt="屏幕截图 2025-05-14 210251" style="zoom:50%;" />

于是我们照着第二题的思路就能通关。

~~~
' onclick=alert(1) '
~~~

***

## 第四关



<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-14 211602.png" alt="屏幕截图 2025-05-14 211602" style="zoom:50%;" />

这题的思路其实与前两题差不多，但有一个区别，通过分析第四题的php代码，我们发现这道题并没有像第三题那样过滤双引号，而是过滤了尖括号，这意味着我们不能通过<script>alert("1")</script>来插入alert，所以我们可以输入以下代码来解决。

​                                                                    ![屏幕截图 2025-05-14 211722](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-14 211722.png)

~~~
" onclick=alert(1) "
~~~



***



## 第五关（js伪协议）

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-13 212249.png" alt="屏幕截图 2025-05-13 212249" style="zoom:50%;" />

### 解题过程

首先我们还是使用上一题的技巧看行不行，我们在对话框中输入

~~~
" onclick=alert(1) "
~~~

但是我们发现在源码中，双引号虽然成功闭合，但onclick却变成了o_nclick，这表示这个词过滤掉了。同样我们可以输入"> <script>alert("1")</script>，发现其也被过滤掉了。

![屏幕截图 2025-05-15 142528](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-15 142528.png)

其实这从php代码中就可以看出。

![屏幕截图 2025-05-15 142427](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-15 142427.png)



但这个时候我们可以利用js伪协议来解决。

它以javascript:开头，后面跟着要执行的js代码。例如，javascript:alert('Hello World');这样的URL，当用户访问时，浏览器会执行这段JavaScript代码，弹出一个显示“Hello World”的警告框。

这不仅能在URL中用，还可以用于一些特殊的属性中，如href等。而这题显然没有过滤href属性。于是我们输入

~~~
"> <a href=javascript:alert(1)>点击</a>  
~~~

让alert通过伪协议的方式插入，由于href的不被过滤，就会出现一个跳脱输入框之外的链接，点击即可通关。

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-15 144116.png" alt="屏幕截图 2025-05-15 144116" style="zoom:50%;" />

***



## 第六关（大小写跳过）





<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-12 214515.png" alt="屏幕截图 2025-05-12 214515" style="zoom:50%;" />





### 解题过程

首先我还是先运用伪协议输入以下代码来试一下

```
"> <a href=javascript:alert(1)>点击</a>或  "> <script>alert("1")</script>
```

结果发现虽然双引号没有被过滤，但出现了以下情况：发现我们输入的href变成了hr_ef，导致该属性不可用，这很显然被过滤了，·从而无法将alert插入，达到我们的效果。



![屏幕截图 2025-05-13 210259](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-13 210259.png)



于是我查看了这道题的后端代码，发现了他通过str_replace对特定词进行了一个替换，在词中加入了 "_ ''。导致我们输入的关键词被替代。这个时候我们可以想到使用大小写替换的方式。



![屏幕截图 2025-05-13 210917](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-13 210917.png)

原理很简单，就是抓住php替换函数是默认区分大小写（替换严格匹配）这个问题，举个例子：只有长成“script”的才会被替换，而“Script”则不会,及我们可以对关键词中任意字母大写来绕过这个替换，从而达到我们的目的。于是我们输入

```
"> <a hrEf=javascript:alert(1)>点击</a>  或  "> <sCript>alert("1")</sCript>
```



就可以成功解决。

***



## 第七关（双写跳过）

 <img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-12 164940.png" alt="屏幕截图 2025-05-12 164940" style="zoom:50%;" />

### **解题过程 **

首先我还是先运用伪协议输入以下代码来试一下

```
"> <a href=javascript:alert(1)>点击</a>  或  "> <script>alert("1")</script>
```

结果出现了以下情况

![屏幕截图 2025-05-12 170415](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-12 170415.png)

![屏幕截图 2025-05-12 170433](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-12 170433.png)

我发现虽然双引号已经成功闭合了，但是 **href** 标签和 javascript 中的 **script** 却消失了，于是通过分析后端代码我发现此题使用了str_replace函数将一些标签替换成了“ ”（空），并且使用了strtolower函数来避免如第六关一样的大小写跳过。

![屏幕截图 2025-05-12 171703](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-12 171703.png)

所以这里可以使用双写跳过的方式，输入以下代码

```
"> <a hrhrefef=javascscriptript:alert(1)>点击</a>  或  "> <scscriptript>alert("1")</scscriptript>
```

就是将被封锁的特定标签拆成前后两半，然后加在该标签的前面和后面，这样在编译时就只会删除中间的特定标签，然后留下的部分拼起来还是该标签，如hrhrefef在删去href后的hr和ef仍能拼成href。

![屏幕截图 2025-05-12 172630](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-12 172630.png)

最后变成这样点击就行了

***

## 第八关(转换为uincode)

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-12 175322.png" alt="屏幕截图 2025-05-12 175322" style="zoom:50%;" />

### 解题过程

首先观察这一关和之前把不同的是多了一个“友情链接”，其实也就是多了一个a标签，而这个a标签中href属性中的内容和我们在对话框中输入的一模一样。所以我们可以通过控制我们的输入来控住这个链接，将alert放入其中。

![屏幕截图 2025-05-12 180046](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-12 180046.png)

所以我们可以想到如果我们在对话框中输入如下代码

```
javascript:alert(1)
```

我们期望的是“友情链接”中就会变成如第七题中那样，但结果却是这样

![屏幕截图 2025-05-12 193047](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-12 193047.png)

通过查看后端代码我们可以知道他通过str_replace对特定词进行了一个替换，但他并没有像第七题那样被替换为“ ”(空)，而是在词中加入了 "_ '',这导致我们不能第七题用双写跳过的方法，而使用了strtolower函数来避免如第六关一样的大小写跳过。那我们只能用别的方法来绕过，通过在b站上找视频，我了解到浏览器在解析js的属性值时是支持10进制和16进制uincode编码的，那我们就可以将通过一些解密工具将javascript:alert(1)转化为uincode的形式对他进行输入，以此来绕过。这里我选用解密工具的是Captfencode v3。在Cap中的

converter中选中uincom，

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-12 194732.png" alt="屏幕截图 2025-05-12 194732" style="zoom: 33%;" />

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-12 194742.png" alt="屏幕截图 2025-05-12 194742" style="zoom: 50%;" />

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-12 194830.png" alt="屏幕截图 2025-05-12 194830" style="zoom:50%;" />

然后将要输入的内容输到input中，output中即为其uincode码，然后将uincode码输到对话框中，就可以成功绕过了。

![屏幕截图 2025-05-12 195229](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-12 195229.png)

***

## 第九关

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-12 195418.png" alt="屏幕截图 2025-05-12 195418" style="zoom:50%;" />

### 解题过程

这关和第八关一样都有一个“友情链接”，但如果我们还是只输入JavaScript：alert（1)的uincode码就会出现跳转到一个错误的页面

![屏幕截图 2025-05-12 195835](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-12 195835.png)

我们发现这与上一题的不同在于我们在对话框中输入不会同步转到a标签的href属性里面，这就导致我们无法通过对话框来改变a标签，那这是由于什么产生的呢？看一下后端的代码就能发现，他比第八题的代码多出了一部分，多出来一个if语句。这条语句是用来是用来限制的。即我们必须在对话框的输入中加入“http：//”这样一部分才能将href语句中的内容与输入框同步，否则就出现错误页面。

![屏幕截图 2025-05-12 200319](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-12 200319.png)

我们可以试一下，只输入“http：//”，此时就可以看到href中的变化

![屏幕截图 2025-05-12 200809](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-12 200809.png)

但倘若我们在输入javascript:alert(1)是同时加入http://，这会使该语句不发挥作用，所以我们得将http://给注释掉才行，即输入

~~~
javascripta:alert(1)//http://
~~~

最后像第八题那样将javascripta:alert(1)换成uincom码就行。

***



## 第十关（input标签被隐藏）



<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-14 213521.png" alt="屏幕截图 2025-05-14 213521" style="zoom:50%;" />

## 解题过程

这道题和前面几道不同，他也是和第一题一样没有输入框和一些链接什么的，那我们就可以将目标放在导航栏上，通过对URL参数进行修改或添加来达到插入alert的目的。

我们可以先用第一题的方式来试一下，输入?keyword=<script>alert()</script>，发现好像行不通。但我们发现这道题对我们的输入并没有明显的过滤特征。



<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-14 214730.png" alt="屏幕截图 2025-05-14 214730" style="zoom:50%;" />

我们通过对网站源码的查看，发现这道题是有input标签的，而且有三个，但都被隐藏起来了。一般来说，被隐藏的input标签的赋值是通过其js逻辑去赋值的，也可以通过post和get请求被赋值。

![屏幕截图 2025-05-14 215049](C:\Users\Tong\Pictures\Screenshots\屏幕截图 2025-05-14 215049.png)

拓展：

js赋值：JavaScript可以直接操作HTML文档对象模型（DOM）。隐藏的<input>标签是DOM中的元素，通过JavaScript可以获取到该元素，并修改其value属性来赋值。以下是我在网上找的例子

~~~
<!DOCTYPE html>
<html>

<body>
  <input type="hidden" id="hiddenInput">
  <button onclick="assignValue()">赋值</button>
  <script>
    function assignValue() {
      var hiddenInput = document.getElementById('hiddenInput');
      if (hiddenInput) {
        hiddenInput.value = '通过js赋值';
      }
    }
  </script>
</body>

</html>
~~~

在上述代码中，点击按钮时，assignValue函数会被触发，通过document.getElementById获取隐藏的<input>元素，然后修改其value属性来赋值。

但这里我们直接在URL中利用get请求，我们在URL后加入比方说以下代码，我们发现这些三个被hidden的input标签中有一个标签的一个参数发生了变化。他获取到了我们的get请求，也就是我们在URL上给的一个参数。

ps：在URL中get请求的基本模式：get请求将参数附加在URL后面，以问号?分隔，多个参数之间用&连接。例如：https://example.com/api/search?q=apple&category=fruit，其中q和category是参数名，apple和fruit是对应的值。

~~~
&t_link=123&t_history=123&t_sort=123
~~~

<img src="C:\Users\Tong\Desktop\库\靶场任务图片\屏幕截图 2025-05-15 150129.png" alt="屏幕截图 2025-05-15 150129" style="zoom:75%;" />

所以说我们可以通过控制这个参数来插入alert。我们此时将请输入改成

~~~
&t_sort=" onclick=alert(1) "
~~~

此时我们可以发现onclick属性已经插入源码，但由于input标签隐藏，。我们无法通过点击触发alert。这时我们在后面加上将将隐藏取消。然后点击就ok了！

~~~
type='text'
~~~



